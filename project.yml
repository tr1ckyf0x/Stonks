name: "Stonks"

settings:
  base:
    DEBUG_INFORMATION_FORMAT: dwarf-with-dsym
    CLANG_ANALYZER_LOCALIZABILITY_NONLOCALIZED: YES
    CLANG_ANALYZER_LOCALIZABILITY_EMPTY_CONTEXT: YES
    CLANG_WARN_QUOTED_INCLUDE_IN_FRAMEWORK_HEADER: YES
    ENABLE_HARDENED_RUNTIME: YES
    DEVELOPMENT_TEAM: SGM5527A99
    CODE_SIGN_STYLE: Automatic
    MARKETING_VERSION: 1.0.6
    CURRENT_PROJECT_VERSION: 1.0.6

options:
  deploymentTarget:
    macOS: 12.0
  preGenCommand: ./Scripts/autogenerated_files.sh

attributes:
  ORGANIZATIONNAME: "Vladislav Lisianskii"

packages:

  Swinject:
    url: https://github.com/Swinject/Swinject
    from: 2.8.0

  Firebase:
    url: https://github.com/firebase/firebase-ios-sdk
    from: 9.2.0

  # Local packages

  ## Core
  STNetworking:
    path: Packages/STNetworking
    group: Core

  CoinMarketProvider:
    path: Packages/CoinMarketProvider
    group: Core

  Models:
    path: Packages/Models
    group: Core

  KeychainService:
    path: Packages/KeychainService
    group: Core

  CoinCapPriceService:
    path: Packages/CoinCapPriceService
    group: Core

  UpdateService:
    path: Packages/UpdateService
    group: Core

  MenuBarModels:
    path: Packages/MenuBarModels
    group: Core

  Log:
    path: Packages/Log
    group: Core

  AnalyticsService:
    path: Packages/AnalyticsService
    group: Core

  ## UI
  SharedResources:
    path: Packages/SharedResources
    group: UI

  MenuBarResources:
    path: Packages/MenuBarResources
    group: UI

  CryptoImageFactory:
    path: Packages/CryptoImageFactory
    group: UI

  ## Feature
  StatusItemController:
    path: Packages/StatusItemController
    group: Feature

  MenuBarView:
    path: Packages/MenuBarView
    group: Feature

  MenuPopoverView:
    path: Packages/MenuPopoverView
    group: Feature

targets:
  Stonks:
    platform: macOS
    type: application
    sources:
      - path: "Stonks"
        excludes:
          - "swiftgen.yml"
    dependencies:
      - target: StonksWidget
      - package: KeychainService

    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.tr1ckyf0x.stonks
        CODE_SIGN_ENTITLEMENTS: "Stonks/Resources/Stonks.entitlements"
        DEVELOPMENT_ASSET_PATHS: "\"Stonks/Preview Content\""
        ENABLE_PREVIEWS: YES

  StonksWidget:
    platform: macOS
    type: app-extension
    sources:
      - path: StonksWidget
        excludes:
          - "swiftgen.yml"
    dependencies:
      - package: SharedResources
      - package: CoinMarketProvider
      - package: STNetworking
      - package: KeychainService
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.tr1ckyf0x.stonks.widget
        CODE_SIGN_ENTITLEMENTS: "StonksWidget/StonksWidget.entitlements"
        OTHER_LDFLAGS: $(inherited) -framework WidgetKit -framework SwiftUI

  StonksTracker:
    platform: macOS
    type: application
    sources:
      - path: "StonksTracker"
        excludes:
          - "swiftgen.yml"
          - "**/*.secret"
    dependencies:
      - package: Swinject
      - package: StatusItemController
      - package: MenuBarView
      - package: CoinCapPriceService
        product: CoinCapPriceService
      - package: UpdateService
        product: UpdateService
      - package: Log
      - package: Firebase
        product: FirebaseAnalytics
      - package: Firebase
        product: FirebaseCrashlytics
      - package: AnalyticsService
    postBuildScripts:
      - name: "Crashlytics"
        script: |
                ${BUILD_DIR%/Build/*}/SourcePackages/checkouts/firebase-ios-sdk/Crashlytics/run
        inputFiles:
          - ${DWARF_DSYM_FOLDER_PATH}/${DWARF_DSYM_FILE_NAME}/Contents/Resources/DWARF/${TARGET_NAME}
          - $(SRCROOT)/$(BUILT_PRODUCTS_DIR)/$(INFOPLIST_PATH)

    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.tr1ckyf0x.stonks.tracker
        CODE_SIGN_ENTITLEMENTS: "StonksTracker/Resources/StonksTracker.entitlements"
